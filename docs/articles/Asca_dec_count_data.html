<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASCA Decomposition of Synthetic Count Data • ASCA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ASCA Decomposition of Synthetic Count Data">
<meta property="og:description" content="ASCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ASCA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Asca_dec_count_data.html">ASCA Decomposition of Synthetic Count Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Asca_dec_count_data_files/header-attrs-2.5/header-attrs.js"></script><link href="Asca_dec_count_data_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Asca_dec_count_data_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ASCA Decomposition of Synthetic Count Data</h1>
                        <h4 class="author">Pietro Franceschi</h4>
            
            <h4 class="date">2021-03-03</h4>
      
      
      <div class="hidden name"><code>Asca_dec_count_data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<ul>
<li>Visualize the characteristics of Multifactorial designs in multivariate context.</li>
<li>With standard PCA one focuses on the effect responsible of the larger variance. This does not allow neither to disentagle the contribution of the different design factors nor to pinpoint the variables which are most influential for each factor</li>
<li>The idea of ASCA is to couple ANOVA decomposition with PCA. ANOVA is used to model each variable as a function of the different elements of the design, PCA is then applied drive a multivariate interpretation of the matrices holding the univariate expected values for each design factor.</li>
<li>In matrix representation the ASCA decomposition is Y = A + B + C + … + Err where each matrix holds the expected values</li>
<li>The expected values can be estimated in different way, but using glm to do that has two advantages: the approach can be applied the method to unbalanced designs, one can extend the idea to response variables with non gaussian distribution like the one which are encountered in ecology or metagenomics.</li>
<li>This second perspective is extremely interesting due to the growing availability of complex ecological and biological datasets</li>
</ul>
</div>
<div id="the-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#the-dataset" class="anchor"></a>The dataset</h2>
<p>To illustrate the usefulness of ASCA in the analysis of count data we will considered a synthetic dataset which is available as a part of the package installation.</p>
<div id="experimental-design" class="section level3">
<h3 class="hasAnchor">
<a href="#experimental-design" class="anchor"></a>Experimental design</h3>
<ul>
<li>10 count variables (identified as <code>s1 .. s10</code>)</li>
<li>2 factor design (5 time points, 3 treatments)</li>
<li>45 samples</li>
</ul>
<p>The synthetic dataset was designed to have 2 latent variables for the time factor and one for the treatment.</p>
<p>The synthetic dataset is composed by a two element list containing the count matrix <code>synth_count_data$counts</code> and a data frame holding the association between the 45 samples and the design factors (<code>synth_count_data$design</code>)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load the library</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ASCA</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: parallel</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ASCA'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     loadings</span>

<span class="co">## load the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"synth_count_data"</span><span class="op">)</span>

<span class="co">## this show a compat view of the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">)</span>
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ counts: int [1:45, 1:10] 2 1 1 0 2 0 0 0 0 4 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ design:'data.frame':  45 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ time     : chr [1:45] "t1" "t1" "t1" "t1" ...</span>
<span class="co">#&gt;   ..$ treatment: chr [1:45] "A" "A" "A" "B" ...</span></code></pre></div>
<p>The following plot shows an example of the distribution of the counts for the first specie as a function of the design factors</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Palette for time factor</span>
<span class="va">timepal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e41a1c"</span>,<span class="st">"#377eb8"</span>,<span class="st">"#4daf4a"</span>,<span class="st">"#984ea3"</span>,<span class="st">"#ff7f00"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">timepal</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>

<span class="co">## point shapes for treatments</span>
<span class="va">treatpch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">13</span>,<span class="fl">17</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">treatpch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>


<span class="co">## plot the trend of the first specie</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, 
     col <span class="op">=</span> <span class="va">timepal</span><span class="op">[</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">]</span>, 
     pch <span class="op">=</span> <span class="va">treatpch</span><span class="op">[</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"Counts"</span>, xlab <span class="op">=</span> <span class="st">"Sample id"</span>, main <span class="op">=</span> <span class="st">"Specie 1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">timepal</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">timepal</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, pch <span class="op">=</span> <span class="va">treatpch</span>, col <span class="op">=</span> <span class="st">"gray70"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">treatpch</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-2-1.png" alt="Illustration of the effects of the experimental design on the counts of Specie #1" width="700"><p class="caption">
Illustration of the effects of the experimental design on the counts of Specie #1
</p>
</div>
<p>The previous plot clearly shows the non normal distribution of the count data and the effects of the sesign factors (and of their interaction) on the abundances.</p>
</div>
</div>
<div id="performing-the-decomposition" class="section level2">
<h2 class="hasAnchor">
<a href="#performing-the-decomposition" class="anchor"></a>Performing the decomposition</h2>
<p>The function which performs the decomposition is <code>ASCA</code>. The results are organized as an S3 object. To perform the decomposition it is necessary to provide</p>
<ul>
<li>a <code>matrix</code> with the counts</li>
<li>a <code>data.frame</code> with the association between the samples and the design</li>
<li>a formula (actually a character vector) which specify the form of the decomposition</li>
<li>a <code>list</code> with the parameters which will be passed to the <code>glm</code> call</li>
</ul>
<p>In the case of count data, the glm should be performed by specifying a Poisson family</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## perform the decomposition</span>
<span class="va">asca0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA.html">ASCA</a></span><span class="op">(</span>
  d <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>,
  x <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span>, 
  f <span class="op">=</span> <span class="st">"time + treatment + time:treatment"</span>,
  glm_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>


<span class="va">asca0</span>
<span class="co">#&gt; ASCA decomposition </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of samples  45 </span>
<span class="co">#&gt; Number of variables 10 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:  time + treatment + time:treatment </span>
<span class="co">#&gt; Terms: time,treatment,time:treatment,error</span></code></pre></div>
<p>Some additional details can be obtained by calling the <code>summary</code> method</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">)</span>
<span class="co">#&gt; ASCA decomposition </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of samples  45 </span>
<span class="co">#&gt; Number of variables 10 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:  time + treatment + time:treatment </span>
<span class="co">#&gt; Terms: time,treatment,time:treatment,error</span>
<span class="co">#&gt; Validation:  FALSE </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; glm parameters: </span>
<span class="co">#&gt; $family</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: poisson </span>
<span class="co">#&gt; Link function: log</span></code></pre></div>
<p>For each one of the decomposition terms (here time, treatment, time:treatment and error) the decomposition will provide loadings, scores and variable importance. The number of components for each factor (i.e. the rank of the corresponding matrix) is determined by the number of levels of the initial design.</p>
<ul>
<li>The <strong>loadings</strong> measure the importance of each one of the initial species to each factor of each component</li>
<li>The <strong>scores</strong>
</li>
</ul>
<p>Loadings, scores and variable importance can be extracted from the asca object by the <code>loadings</code>, <code>scores</code> and <code>varimp</code> methods</p>
</div>
<div id="visualizing-the-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-the-outcomes" class="anchor"></a>Visualizing the outcomes</h2>
</div>
<div id="validating-the-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#validating-the-outcomes" class="anchor"></a>Validating the outcomes</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Pietro Franceschi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
